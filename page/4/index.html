<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.jpg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="3Golds">
<meta property="og:url" content="http://zhaodaxin.com/page/4/index.html">
<meta property="og:site_name" content="3Golds">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3Golds">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zhaodaxin.com/page/4/"/>





  <title>3Golds</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">3Golds</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ThreeGold</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaodaxin.com/2017/02/17/2017-02-17-aws-在线扩容/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="3Golds">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gophers.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="3Golds">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/17/2017-02-17-aws-在线扩容/" itemprop="url">AWS EBS 在线扩容</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-17T00:00:00+08:00">
                2017-02-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/02/17/2017-02-17-aws-在线扩容/" class="leancloud_visitors" data-flag-title="AWS EBS 在线扩容">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  247
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="AWS-Management-Console-扩容ebs容量"><a href="#AWS-Management-Console-扩容ebs容量" class="headerlink" title="AWS Management Console 扩容ebs容量"></a>AWS Management Console 扩容ebs容量</h3><p>原文连接：<a href="https://aws.amazon.com/blogs/aws/amazon-ebs-update-new-elastic-volumes-change-everything/" target="_blank" rel="noopener">https://aws.amazon.com/blogs/aws/amazon-ebs-update-new-elastic-volumes-change-everything/</a></p>
<h4 id="1-选择扩容设备"><a href="#1-选择扩容设备" class="headerlink" title="1.选择扩容设备"></a>1.选择扩容设备</h4><p><img src="http://obbogqhb1.bkt.clouddn.com/ebs1.png" alt="ebs1"></p>
<h4 id="2-修改扩容容量"><a href="#2-修改扩容容量" class="headerlink" title="2.修改扩容容量"></a>2.修改扩容容量</h4><p><img src="http://obbogqhb1.bkt.clouddn.com/ebs2.png" alt="ebs2"></p>
<h4 id="4-等待其状态达到100"><a href="#4-等待其状态达到100" class="headerlink" title="4.等待其状态达到100%"></a>4.等待其状态达到100%</h4><p><img src="http://obbogqhb1.bkt.clouddn.com/ebs3.png" alt="ebs3"></p>
<h4 id="扩容磁盘分区"><a href="#扩容磁盘分区" class="headerlink" title="扩容磁盘分区"></a>扩容磁盘分区</h4><p><code>growpart</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">growpart /dev/xvdf 1</span><br></pre></td></tr></table></figure>
<p><code>parted</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GNU Parted 2.3</span><br><span class="line"></span><br><span class="line">Using /dev/xvdf1</span><br><span class="line"></span><br><span class="line">Welcome to GNU Parted! Type &apos;help&apos; to view a list of commands.</span><br><span class="line"></span><br><span class="line">(parted) print</span><br><span class="line"></span><br><span class="line">Model: Unknown (unknown)</span><br><span class="line"></span><br><span class="line">Disk /dev/xvdf1: 80.7GB</span><br><span class="line"></span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line"></span><br><span class="line">Partition Table: loop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Number  Start  End     Size    File system  Flags</span><br><span class="line"></span><br><span class="line"> 1      0.00B  53.7GB  53.7GB  ext4</span><br><span class="line"></span><br><span class="line">(parted) resizepart 1 80.7GB  # resizepart NUMBER END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Warning: Partition /dev/xvdf1 is being used. Are you sure you want to continue?</span><br><span class="line"></span><br><span class="line">parted: invalid token: 53.7GB</span><br><span class="line"></span><br><span class="line">Yes/No? yes</span><br><span class="line"></span><br><span class="line">End?  [53.7GB]? 80.7GB</span><br><span class="line"></span><br><span class="line">(parted) quit</span><br></pre></td></tr></table></figure>
<h4 id="扩容文件系统"><a href="#扩容文件系统" class="headerlink" title="扩容文件系统"></a>扩容文件系统</h4><h5 id="1-ext系列"><a href="#1-ext系列" class="headerlink" title="1.ext系列"></a>1.ext系列</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fdisk -l /dev/xvdf # 查看扩容分区容量是否成功</span><br><span class="line"></span><br><span class="line">resize2fs /dev/xvdf1</span><br></pre></td></tr></table></figure>
<h5 id="2-xfs系列"><a href="#2-xfs系列" class="headerlink" title="2.xfs系列"></a>2.xfs系列</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">xfs_growfs /dev/xvdf1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>作者：Antony WX&amp;QQ：1257465991<br>Q/A：如有问题请慷慨提出</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaodaxin.com/2017/02/08/2017-02-08-Yahoo-screwdriver-开源了/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="3Golds">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gophers.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="3Golds">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/08/2017-02-08-Yahoo-screwdriver-开源了/" itemprop="url">Yahoo-screwdriver开源了</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-08T00:00:00+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/02/08/2017-02-08-Yahoo-screwdriver-开源了/" class="leancloud_visitors" data-flag-title="Yahoo-screwdriver开源了">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  310
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="screwdriver-介绍"><a href="#screwdriver-介绍" class="headerlink" title="screwdriver 介绍"></a>screwdriver 介绍</h3><p><strong>screwdriver 是yahoo开源的一款发布工具，用于大规模持续交付到生产的动态基础架构.</strong></p>
<p><strong>这应该是目前最完整拥有CI(持续集成Continuous integration)和CD(持续交付Continuous delivery)的专案.</strong></p>
<ul>
<li><strong>官网</strong>: <a href="http://screwdriver.cd/" target="_blank" rel="noopener">http://screwdriver.cd/</a></li>
<li><strong>Doc</strong>: <a href="http://docs.screwdriver.cd/user-guide/quickstart/" target="_blank" rel="noopener">http://docs.screwdriver.cd/user-guide/quickstart/</a></li>
<li><strong>Github</strong>: <a href="https://github.com/screwdriver-cd" target="_blank" rel="noopener">https://github.com/screwdriver-cd</a></li>
<li><strong>Docker</strong>: <a href="https://hub.docker.com/u/screwdrivercd/" target="_blank" rel="noopener">https://hub.docker.com/u/screwdrivercd/</a></li>
</ul>
<h4 id="特色"><a href="#特色" class="headerlink" title="特色"></a>特色</h4><ul>
<li><p>1.使部署通道更容易 (Making deployment pipelines easy)</p>
</li>
<li><p>2.优化主干开发(Optimizing for trunk development)</p>
</li>
<li><p>3.回滚更加容易(Making rolling back easy)</p>
</li>
</ul>
<p>详情请阅:<a href="https://yahooeng.tumblr.com/post/155765242061/open-sourcing-screwdriver-yahoos-continuous" target="_blank" rel="noopener">yahooeng.tumblr.com</a></p>
<h3 id="Screwdrive-架构和开发流程"><a href="#Screwdrive-架构和开发流程" class="headerlink" title="Screwdrive 架构和开发流程"></a>Screwdrive 架构和开发流程</h3><p>详情请查看：<a href="http://docs.screwdriver.cd/cluster-management/" target="_blank" rel="noopener">http://docs.screwdriver.cd/cluster-management/</a></p>
<h4 id="组件"><a href="#组件" class="headerlink" title="组件:"></a>组件:</h4><ul>
<li><p><strong>1.REST API</strong>(与流水线协同工作的接口)</p>
</li>
<li><p><strong>2.Web UI</strong>(用于流水线API的可视化接口)</p>
</li>
<li><p><strong>3.Launcher</strong>（启动器）: 设置环境并执行shell命令的工具</p>
</li>
<li><p><strong>4.Execution Engine</strong>（执行引擎）：可插拔的构建执行器，支持在容器（Jenkins、Kubernetes、Mesos、Docker Swarm）内执行命令。</p>
</li>
<li><p><strong>5.Datastore</strong>（数据存储）：可插拔的NoSQL存储，用于维护流水线配置数据（DynamoDB、MongoDB、CouchDB、Postgres）。执行引擎和数据存储都使用了可插拔的架构，使得用户可按自身意向选用引擎。</p>
</li>
</ul>
<p><img src="http://obbogqhb1.bkt.clouddn.com/yahoo.png" alt="Yahho png"></p>
<blockquote>
<p>作者：Antony WX&amp;QQ：1257465991<br>Q/A：如有问题请慷慨提出</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaodaxin.com/2017/02/04/2017-01-23-Gitlab-Omnibus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="3Golds">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gophers.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="3Golds">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/2017-01-23-Gitlab-Omnibus/" itemprop="url">Gitlab-Omnibus</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-04T00:00:00+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/02/04/2017-01-23-Gitlab-Omnibus/" class="leancloud_visitors" data-flag-title="Gitlab-Omnibus">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,240
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、Gitlab简介"><a href="#一、Gitlab简介" class="headerlink" title="一、Gitlab简介"></a>一、Gitlab简介</h3><p><img src="http://obbogqhb1.bkt.clouddn.com/Gitlab1.png" alt="Gitlab1.png"></p>
<p><strong>组件说明</strong></p>
<ul>
<li><p><strong>前端</strong>：Nginx，用于页面及Git tool走http或https协议</p>
</li>
<li><p><strong>后端</strong>：Gitlab服务，采用Ruby on Rails框架，通过unicorn实现后台服务及多进程</p>
</li>
<li><p><strong>SSHD</strong>：开启sshd服务，用于用户上传ssh key进行版本克隆及上传。注：用户上传的ssh key是保存到git账户中</p>
</li>
<li><p><strong>数据库</strong>：目前仅支持MySQL和PostgreSQL</p>
</li>
<li><p><strong>Redis</strong>：用于存储用户session和任务，任务包括新建仓库、发送邮件等等</p>
</li>
<li><p><strong>Sidekiq</strong>：Rails框架自带的，订阅redis中的任务并执行</p>
</li>
</ul>
<p><strong>版本说明</strong></p>
<ul>
<li><p><strong>CE(GitLab Community Edition)</strong>：社区版(源码安装方式) <a href="https://docs.gitlab.com/ce/README.html" target="_blank" rel="noopener">https://docs.gitlab.com/ce/README.html</a></p>
</li>
<li><p><strong>OM(Omnibus GitLab)</strong>：综合版(包安装方式) <a href="https://docs.gitlab.com/omnibus/README.html" target="_blank" rel="noopener">https://docs.gitlab.com/omnibus/README.html</a></p>
</li>
<li><p><strong>EE(GitLab Enterprise Edition)</strong>：企业版 <a href="https://docs.gitlab.com/ee/README.html" target="_blank" rel="noopener">https://docs.gitlab.com/ee/README.html</a></p>
</li>
</ul>
<h3 id="二、Gitlab-Omnibus-安装和配置"><a href="#二、Gitlab-Omnibus-安装和配置" class="headerlink" title="二、Gitlab Omnibus 安装和配置"></a>二、Gitlab Omnibus 安装和配置</h3><p><strong>1. 安装和配置依赖环境</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install curl openssh-server ca-certificates postfix</span><br></pre></td></tr></table></figure>
<p><strong>2. 添加gitlab 包并安装</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash</span><br><span class="line">sudo apt-get install gitlab-ce</span><br></pre></td></tr></table></figure>
<p>如果安装很慢，可以选择下载程序包后安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://packages.gitlab.com/gitlab/gitlab-ce/install</span><br></pre></td></tr></table></figure>
<p><strong>3. 配置gitlab</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
<p><strong>4.配置Nginx</strong></p>
<p><a href="https://docs.gitlab.com/omnibus/settings/nginx.html" target="_blank" rel="noopener">https://docs.gitlab.com/omnibus/settings/nginx.html</a></p>
<p><code>配置https</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /etc/gitlab/ssl</span><br><span class="line"></span><br><span class="line">$ chmod 700 /etc/gitlab/ssl</span><br><span class="line"></span><br><span class="line">$ cp /etc/gitlab/ssl/* /etc/gitlab/trusted-certs/ # 注意：ssl下面的是证书文件</span><br><span class="line"></span><br><span class="line">$ vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line">external_url &quot;https://git.xxx.com&quot;</span><br><span class="line"></span><br><span class="line">nginx[&apos;redirect_http_to_https&apos;] = true</span><br><span class="line"></span><br><span class="line">nginx[&apos;ssl_certificate&apos;] = &quot;/etc/gitlab/ssl/xxx.com.chain.crt&quot;</span><br><span class="line"></span><br><span class="line">nginx[&apos;ssl_certificate_key&apos;] = &quot;/etc/gitlab/ssl/xxx.com.key&quot;</span><br><span class="line"></span><br><span class="line"> nginx[&apos;proxy_set_headers&apos;] = &#123;</span><br><span class="line"></span><br><span class="line">  &quot;X-Forwarded-Proto&quot; =&gt; &quot;http&quot;,</span><br><span class="line"></span><br><span class="line">  &quot;CUSTOM_HEADER&quot; =&gt; &quot;VALUE&quot;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><strong>5.配置LDAP</strong></p>
<p>参考配置：<a href="https://docs.gitlab.com/ce/administration/auth/ldap.html" target="_blank" rel="noopener">https://docs.gitlab.com/ce/administration/auth/ldap.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">gitlab_rails[&apos;ldap_enabled&apos;] = true</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;ldap_servers&apos;] = YAML.load &lt;&lt;-&apos;EOS&apos; # remember to close this block with &apos;EOS&apos; below</span><br><span class="line"></span><br><span class="line">  main: # &apos;main&apos; is the GitLab &apos;provider ID&apos; of this LDAP server</span><br><span class="line"></span><br><span class="line">     label: &apos;xxx-ldap&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     host: &apos;LDAP_HOST&apos;</span><br><span class="line"></span><br><span class="line">     port: 389</span><br><span class="line"></span><br><span class="line">     uid: &apos;uid&apos;</span><br><span class="line"></span><br><span class="line">     bind_dn: &apos;cn=Directory Manager&apos;</span><br><span class="line"></span><br><span class="line">     password: &apos;PASSWORD&apos;</span><br><span class="line"></span><br><span class="line">     base: &apos;ou=People,dc=xxx,dc=com&apos;</span><br><span class="line"></span><br><span class="line">     active_directory: false</span><br><span class="line"></span><br><span class="line">     method: &apos;plain&apos; # &quot;tls&quot; or &quot;ssl&quot; or &quot;plain&quot;</span><br><span class="line"></span><br><span class="line">     user_filter: &apos;(objectClass=xxx-ldap)&apos;</span><br><span class="line"></span><br><span class="line">EOS</span><br></pre></td></tr></table></figure>
<p><strong>6.配置EMAIL</strong></p>
<p>参考配置：<a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/smtp.md" target="_blank" rel="noopener">https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/smtp.md</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ sudo vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;smtp_enable&apos;] = true</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;smtp_address&apos;] = &quot;Your_EMAIL_SERVER_ADDRESS&quot;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;smtp_port&apos;] = 25</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;smtp_user_name&apos;] = &quot;EMAIL_SERVER_USER&quot;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;smtp_password&apos;] = &quot;EMAIL_SERVER_PASSWORD&quot;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;smtp_authentication&apos;] = &quot;login&quot;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;gitlab_email_from&apos;] = &apos;xxx@xx.com&apos;</span><br></pre></td></tr></table></figure>
<p><strong>7.重新加载配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
<p><strong>Testing the SMTP configuration</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ sudo gitlab-rails console</span><br><span class="line"></span><br><span class="line">irb(main):003:0&gt; Notify.test_email(&apos;destination_email@address.com&apos;, &apos;Message Subject&apos;, &apos;Message Body&apos;).deliver_now</span><br></pre></td></tr></table></figure>
<h3 id="三、Gitlab-备份及恢复"><a href="#三、Gitlab-备份及恢复" class="headerlink" title="三、Gitlab 备份及恢复"></a>三、Gitlab 备份及恢复</h3><p><code>backup</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo gitlab-rake gitlab:backup:create</span><br><span class="line"></span><br><span class="line">可选参数：SKIP=db,upload 或者SKIP=db或者SKIP=upload</span><br></pre></td></tr></table></figure>
<p><code>resotre</code></p>
<p><strong>a. 停止服务</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo cp 1393513186_gitlab_backup.tar /var/opt/gitlab/backups/</span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl stop unicorn</span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl stop sidekiq</span><br></pre></td></tr></table></figure>
<p><strong>b.查看其状态</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo gitlab-ctl status</span><br></pre></td></tr></table></figure>
<p><strong>c.还原</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ sudo gitlab-rake gitlab:backup:restore BACKUP=1393513186_2014_02_27</span><br><span class="line"></span><br><span class="line"> 可选参数</span><br><span class="line"></span><br><span class="line"> $ sudo gitlab-rake gitlab:backup:restore SKIP=db,upload BACKUP=1342713186_2014_02_27</span><br></pre></td></tr></table></figure>
<p><strong>d. 重启并检查</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo gitlab-ctl start </span><br><span class="line"></span><br><span class="line">sudo gitlab-rake gitlab:check SANITIZE=true</span><br></pre></td></tr></table></figure>
<h3 id="四、禁用Gitlab-nginx使用production-nginx"><a href="#四、禁用Gitlab-nginx使用production-nginx" class="headerlink" title="四、禁用Gitlab nginx使用production-nginx"></a>四、禁用Gitlab nginx使用production-nginx</h3><p><strong>禁用gitlab nginx</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line">nginx[&apos;enable&apos;] = false</span><br></pre></td></tr></table></figure>
<p><strong>重新配置gitlab</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
<p><strong>使用production配置</strong><br><code>建议：将/var/opt/gitlab/nginx/conf下面的配置文件直接复制过来，稍作修改即可</code><br>参考配置：<a href="http://docs.gitlab.com/omnibus/settings/nginx.html" target="_blank" rel="noopener">http://docs.gitlab.com/omnibus/settings/nginx.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#注意：拷贝前备份</span><br><span class="line">cp /var/opt/gitlab/ngin/conf/* /usr/local/nginx/conf/</span><br></pre></td></tr></table></figure>
<h3 id="五、禁用Gitlab-postgresql使用production-pgsql"><a href="#五、禁用Gitlab-postgresql使用production-pgsql" class="headerlink" title="五、禁用Gitlab postgresql使用production-pgsql"></a>五、禁用Gitlab postgresql使用production-pgsql</h3><p><strong>1.禁用Gitlab postgresql</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line">postgresql[&apos;enable&apos;] = false</span><br></pre></td></tr></table></figure>
<p><strong>2.导入Gitlab 备份sql到production postgresql</strong></p>
<p>连接数据库并创建(注意，在最后创建数据库的时候，如果出现报错，请使用gitlab用户登录并创建)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ psql -U PSQL_USER -h PSQL_HOST -p 5432 -d template1</span><br><span class="line"></span><br><span class="line">template1 &gt; CREATE USER gitlab CREATEDB WITH PASSWORD &apos;PASSWORD&apos;;</span><br><span class="line"></span><br><span class="line">template1 &gt; CREATE EXTENSION IF NOT EXISTS pg_trgm;</span><br><span class="line"></span><br><span class="line">template1 &gt; CREATE DATABASE gitlabhq_production OWNER gitlab</span><br><span class="line"></span><br><span class="line"># 导入备份文件</span><br><span class="line"></span><br><span class="line">psql -U PSQL_USER -h PSQL_HOST -p 5432 -d DATABASE &lt; SQL_FILE</span><br></pre></td></tr></table></figure>
<p><strong>3.修改gitlab配置，添加production</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/gitlab/gitlab.rb</span><br><span class="line">gitlab_rails[&apos;db_adapter&apos;] = &quot;postgresql&quot;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;db_encoding&apos;] = &apos;utf8&apos;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;db_host&apos;] = &apos;HOST&apos;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;db_port&apos;] = &apos;5432&apos;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;db_username&apos;] = &apos;User_Name&apos;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;db_password&apos;] = &apos;Password&apos;</span><br></pre></td></tr></table></figure>
<p><strong>4.重新配置Gitlab</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">gitlab-ct reconfigure</span><br></pre></td></tr></table></figure>
<h3 id="六、禁用Gitlab-Redis使用production-Redis"><a href="#六、禁用Gitlab-Redis使用production-Redis" class="headerlink" title="六、禁用Gitlab Redis使用production Redis"></a>六、禁用Gitlab Redis使用production Redis</h3><p><strong>配置gitlab</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line">redis[&apos;enable&apos;] = false</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;redis_host&apos;] = &apos;REDIS_HOST&apos;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&apos;redis_port&apos;] = 6379</span><br></pre></td></tr></table></figure>
<p><strong>备份本地redis</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h localhost -p 6379</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379 &gt; SAVE</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">该命令将在 redis 安装目录中创建dump.rdb文件。</span><br></pre></td></tr></table></figure>
<p><strong>恢复数据到production</strong></p>
<p>只需将备份文件 (dump.rdb) 移动到 redis 安装目录并启动服务即可,获取 redis 目录可以使用 CONFIG 命令，如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; CONFIG GET dir</span><br><span class="line"></span><br><span class="line">1) &quot;dir&quot;</span><br><span class="line"></span><br><span class="line">2) &quot;/usr/local/redis/bin&quot;</span><br><span class="line"></span><br><span class="line">以上命令 CONFIG GET dir 输出的 redis 安装目录为 /usr/local/redis/bin。</span><br></pre></td></tr></table></figure>
<p><strong>如果还原的redis在Aws的ElastiCache</strong></p>
<p>在ElastiCache控制面板配置redis(<a href="https://console.amazonaws.cn/elasticache" target="_blank" rel="noopener">https://console.amazonaws.cn/elasticache</a>)</p>
<h5 id="1-创建redis集群"><a href="#1-创建redis集群" class="headerlink" title="1.创建redis集群"></a>1.创建redis集群</h5><p><img src="http://obbogqhb1.bkt.clouddn.com/gitlab2.png" alt="gitlab2.png"></p>
<h5 id="2-配置基本配置"><a href="#2-配置基本配置" class="headerlink" title="2.配置基本配置"></a>2.配置基本配置</h5><p><img src="http://obbogqhb1.bkt.clouddn.com/gitlab3.png" alt="gitlab3.png"></p>
<h5 id="3-配置高级配置"><a href="#3-配置高级配置" class="headerlink" title="3.配置高级配置"></a>3.配置高级配置</h5><p><img src="http://obbogqhb1.bkt.clouddn.com/gitlab4.png" alt="gitlab4.png"></p>
<h5 id="4-等待创建完成后重新配置Gitlab"><a href="#4-等待创建完成后重新配置Gitlab" class="headerlink" title="4. 等待创建完成后重新配置Gitlab"></a>4. 等待创建完成后重新配置Gitlab</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaodaxin.com/2017/01/23/2017-01-23-Ruby环境那些坑/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="3Golds">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gophers.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="3Golds">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/23/2017-01-23-Ruby环境那些坑/" itemprop="url">Ruby 环境那些坑</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-23T00:00:00+08:00">
                2017-01-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/01/23/2017-01-23-Ruby环境那些坑/" class="leancloud_visitors" data-flag-title="Ruby 环境那些坑">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,020
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  9
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>最近接触了很多ruby程序，除了java之外，让我感觉第二耗时、不是很舒服的语言。但是ruby不让人舒服主要还是网络方面的问题，不过只要稍微配置就能让装ruby程序变得飞快，不用一安装一天。本文做个总结和梳理</strong></p>
<h3 id="先介绍下Ruby相关的各种概念（rvm-gem-bundle-rake-rails等）"><a href="#先介绍下Ruby相关的各种概念（rvm-gem-bundle-rake-rails等）" class="headerlink" title="先介绍下Ruby相关的各种概念（rvm, gem, bundle, rake, rails等）"></a>先介绍下Ruby相关的各种概念（rvm, gem, bundle, rake, rails等）</h3><h4 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h4><p>这个就不用多说了</p>
<h4 id="RVM"><a href="#RVM" class="headerlink" title="RVM"></a>RVM</h4><p>用于帮你安装Ruby环境，帮你管理多个Ruby环境，帮你管理你开发的每个Ruby应用使用机器上哪个Ruby环境。Ruby环境不仅仅是Ruby本身，还包括依赖的第三方Ruby插件。都由RVM管理。</p>
<h4 id="Rails"><a href="#Rails" class="headerlink" title="Rails"></a>Rails</h4><p>这个也不用多说，著名开发框架。详细看 <a href="http://zh.wikipedia.org/wiki/Ruby_on_Rails" target="_blank" rel="noopener">http://zh.wikipedia.org/wiki/Ruby_on_Rails</a></p>
<h4 id="RubyGems"><a href="#RubyGems" class="headerlink" title="RubyGems"></a>RubyGems</h4><p>RubyGems是一个方便而强大的Ruby程序包管理器（ package manager），类似RedHat的RPM.它将一个Ruby应用程序打包到一个gem里，作为一个安装单元。无需安装，最新的Ruby版本已经包含RubyGems了。</p>
<h4 id="Gem"><a href="#Gem" class="headerlink" title="Gem"></a>Gem</h4><p>Gem是封装起来的Ruby应用程序或代码库。</p>
<p>注：在终端使用的gem命令，是指通过RubyGems管理Gem包。</p>
<h4 id="Gemfile"><a href="#Gemfile" class="headerlink" title="Gemfile"></a>Gemfile</h4><p>定义你的应用依赖哪些第三方包，bundle根据该配置去寻找这些包。</p>
<h4 id="Rake"><a href="#Rake" class="headerlink" title="Rake"></a>Rake</h4><p>Rake是一门构建语言，和make类似。Rake是用Ruby写的，它支持自己的DSL用来处理和维护Ruby程序。 Rails用rake扩展来完成多种不容任务，如数据库初始化、更新等。</p>
<p>Rake is a build language, similar in purpose to make and ant. Like make and ant it’s a Domain Specific Language, unlike those two it’s an internal DSL programmed in the Ruby language.</p>
<p>PS：个人感觉有点类似Symfony2中的app/console</p>
<h4 id="Rakefile"><a href="#Rakefile" class="headerlink" title="Rakefile"></a>Rakefile</h4><p>Rakefile是由Ruby编写，Rake的命令执行就是由Rakefile文件定义。 &gt; In a gem’s context, the Rakefile is extremely useful. It can hold various tasks to help building, testing and debugging your gem, among all other things that you might find useful.</p>
<p>详细：<a href="http://rake.rubyforge.org/files/doc/rakefile_rdoc.html" target="_blank" rel="noopener">http://rake.rubyforge.org/files/doc/rakefile_rdoc.html</a></p>
<h4 id="Bundle"><a href="#Bundle" class="headerlink" title="Bundle"></a>Bundle</h4><p>相当于多个RubyGems批处理运行。在配置文件gemfilel里说明你的应用依赖哪些第三方包，他自动帮你下载安装多个包，并且会下载这些包依赖的包。 &gt; Bundler maintains a consistent environment for ruby applications. It tracks an application’s code and the rubygems it needs to run, so that an application will always have the exact gems (and versions) that it needs to run.</p>
<p><code>参考</code>: </p>
<ul>
<li><p><a href="https://henter.me/post/ruby-rvm-gem-rake-bundle-rails.html(内容来自这里)" target="_blank" rel="noopener">https://henter.me/post/ruby-rvm-gem-rake-bundle-rails.html(内容来自这里)</a></p>
</li>
<li><p><a href="http://rake.rubyforge.org/" target="_blank" rel="noopener">http://rake.rubyforge.org/</a></p>
</li>
<li><p><a href="http://rake.rubyforge.org/files/doc/rakefile_rdoc.html" target="_blank" rel="noopener">http://rake.rubyforge.org/files/doc/rakefile_rdoc.html</a></p>
</li>
<li><p><a href="http://yinghuayuan8866.blog.163.com/blog/static/2245702720122909571/" target="_blank" rel="noopener">http://yinghuayuan8866.blog.163.com/blog/static/2245702720122909571/</a></p>
</li>
<li><p><a href="http://www.iteye.com/topic/300375" target="_blank" rel="noopener">http://www.iteye.com/topic/300375</a></p>
</li>
<li><p><a href="http://martinfowler.com/articles/rake.html" target="_blank" rel="noopener">http://martinfowler.com/articles/rake.html</a></p>
</li>
<li><p><a href="http://ruby-china.org/topics/2223" target="_blank" rel="noopener">http://ruby-china.org/topics/2223</a></p>
</li>
<li><p><a href="http://www.pcw8510.com/?p=1086" target="_blank" rel="noopener">http://www.pcw8510.com/?p=1086</a></p>
</li>
</ul>
<h3 id="一、Ruby"><a href="#一、Ruby" class="headerlink" title="一、Ruby"></a>一、Ruby</h3><p>在安装ruby的时候，有两个问题</p>
<ul>
<li><p><strong>安装方式</strong></p>
</li>
<li><p><strong>程序包查找</strong></p>
</li>
</ul>
<p>对于第一个问题，分为包安装和源码方式编译安装，因为可以选择版本，一般yum或者apt-get源提供的版本不能打倒我们的要求的时候，我们会选择这个。还有一种就是通过ruby的虚拟环境管理程序RVM(跟python的pyenv一样)，可以控制每个目录使用不同版本的ruby，并且安装很简单，本文主要介绍rvm安装。</p>
<h5 id="RVM安装"><a href="#RVM安装" class="headerlink" title="RVM安装"></a><code>RVM</code>安装</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3</span><br><span class="line"></span><br><span class="line">$ \curl -sSL https://get.rvm.io | bash -s stable</span><br><span class="line"></span><br><span class="line">$ source ~/.bashrc</span><br><span class="line"></span><br><span class="line">$ source ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p>修改 RVM 的 Ruby 安装源到 <a href="https://cache.ruby-china.org/" target="_blank" rel="noopener">Ruby China 的 Ruby</a> 镜像服务器，这样能提高安装速度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ echo &quot;ruby_url=https://cache.ruby-china.org/pub/ruby&quot; &gt; ~/.rvm/user/db</span><br></pre></td></tr></table></figure>
<h5 id="Ruby的安装与切换"><a href="#Ruby的安装与切换" class="headerlink" title="Ruby的安装与切换"></a><code>Ruby</code>的安装与切换</h5><p>列出已知的Ruby版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm list know</span><br></pre></td></tr></table></figure>
<p>安装一个ruby版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">rvm install 2.2.0 --disable-binary</span><br></pre></td></tr></table></figure>
<p>切换ruby版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm use 2.2.0</span><br></pre></td></tr></table></figure>
<p>如果想设置为默认版本，这样一来以后新打开的控制台默认的 Ruby 就是这个版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm use 2.2.0 --default</span><br></pre></td></tr></table></figure>
<p>查看已经安装的Ruby</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm list</span><br></pre></td></tr></table></figure>
<p>卸载一个已经安装的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm remove 1.8.7</span><br></pre></td></tr></table></figure>
<h3 id="二、RubyGems"><a href="#二、RubyGems" class="headerlink" title="二、RubyGems"></a>二、RubyGems</h3><p><strong>第二个坑应该就是gem了，经常通过gem安装程序很慢，或者版本出现问题等等问题，我们接下来先介绍下Gems，然后在展开</strong></p>
<blockquote>
<p>Note: RubyGems是Ruby的一个包管理器，提供了分发Ruby程序和函式库的标准格式“gem”，旨在方便地管理gem安装的工具，以及用于分发gem的服务器。这类似于Python的pip。RubyGems大约创建于2003年11月，从Ruby 1.9版起成为Ruby标准库的一部分</p>
</blockquote>
<h4 id="为了方便读者和自己查阅，在前面介绍下gem-source"><a href="#为了方便读者和自己查阅，在前面介绍下gem-source" class="headerlink" title="为了方便读者和自己查阅，在前面介绍下gem source"></a>为了方便读者和自己查阅，在前面介绍下gem source</h4><p>如何使用？(主要用于解决安装的时候慢，将sources改为国内的，速度有明显提升)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ gem sources --add https://gems.ruby-china.org/ --remove https://rubygems.org/</span><br><span class="line"></span><br><span class="line">$ gem sources -l</span><br><span class="line"></span><br><span class="line">*** CURRENT SOURCES ***</span><br><span class="line"></span><br><span class="line">https://gems.ruby-china.org</span><br><span class="line"></span><br><span class="line"># 请确保只有 gems.ruby-china.org</span><br><span class="line"></span><br><span class="line">$ gem install rails</span><br><span class="line"></span><br><span class="line">如果你使用 Gemfile 和 Bundle (例如：Rails 项目)</span><br></pre></td></tr></table></figure>
<h4 id="gemset的使用"><a href="#gemset的使用" class="headerlink" title="gemset的使用"></a>gemset的使用</h4><p><code>RVM</code> 不仅可以提供一个多 <code>Ruby</code> 版本共存的环境，还可以根据项目管理不同的 <code>gemset</code></p>
<p><code></code></p>
<p><code>gemset</code> 可以理解为是一个独立的虚拟 <code>Gem</code> 环境，每一个 <code>gemset</code> 都是相互独立的。</p>
<p><code></code></p>
<p>比如你有两个项目，一个是 <code>Rails 2.3</code> 一个是 <code>rails3. gemset</code> 可以帮你便捷的建立两套 <code>Gem</code> 开发环境，并且方便的切换。</p>
<p><code></code></p>
<p><code>gemset</code> 是附加在 <code>Ruby</code> 语言版本下面的，例如你用了 <code>1.9.2</code>, 建立了一个叫 <code>rails3</code> 的 <code>gemset</code>,当切换到 <code>1.8.7</code> 的时候，<code>rails3</code> 这个 <code>gemset</code>并不存在。</p>
<h4 id="建立gemset"><a href="#建立gemset" class="headerlink" title="建立gemset"></a>建立gemset</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm use 1.8.7</span><br><span class="line"></span><br><span class="line">rvm gemset create rails23</span><br></pre></td></tr></table></figure>
<p>然后可以设定已经建立的gemset作为当前环境</p>
<h4 id="use-可以用来切换语言或者gemset"><a href="#use-可以用来切换语言或者gemset" class="headerlink" title="use 可以用来切换语言或者gemset"></a>use 可以用来切换语言或者gemset</h4><p>前提是它们已经被安装(或者建立)，并可以在<code>list</code>命令中看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm use 1.8.7</span><br><span class="line"></span><br><span class="line">rvm use 1.8.7@rails23</span><br></pre></td></tr></table></figure>
<p>然后所有安装的Gem都是安装在这个gemset之下</p>
<h4 id="列出当前的Ruby的gemset"><a href="#列出当前的Ruby的gemset" class="headerlink" title="列出当前的Ruby的gemset"></a>列出当前的Ruby的gemset</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm gemset list</span><br></pre></td></tr></table></figure>
<h4 id="清空gemset中的Gem"><a href="#清空gemset中的Gem" class="headerlink" title="清空gemset中的Gem"></a>清空gemset中的Gem</h4><p>如果你想清空一个 gemset 的所有 Gem, 想重新安装所有 Gem，可以这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm gemset empty 1.8.7@rails23</span><br></pre></td></tr></table></figure>
<h4 id="删除一个gemset"><a href="#删除一个gemset" class="headerlink" title="删除一个gemset"></a>删除一个gemset</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm gemset delete rails2-3</span><br></pre></td></tr></table></figure>
<h4 id="项目自动加载gemset"><a href="#项目自动加载gemset" class="headerlink" title="项目自动加载gemset"></a>项目自动加载gemset</h4><p>RVM 还可以自动加载 gemset。 例如我们有一个 Rails 3.1.3 项目，需要 1.9.3 版本 Ruby，整个流程可以这样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm install 1.9.3</span><br><span class="line"></span><br><span class="line">rvm use 1.9.3</span><br><span class="line"></span><br><span class="line">rvm gemset create rails313</span><br><span class="line"></span><br><span class="line">rvm use 1.9.3@rails313</span><br></pre></td></tr></table></figure>
<p>下面进入到项目目录，建立一个 .rvmrc 文件。</p>
<p>在这个文件里可以很简单的加一个命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvm use 1.9.3@rails313</span><br></pre></td></tr></table></figure>
<p>然后无论你当前 Ruby 设置是什么，cd 到这个项目的时候，RVM 会帮你加载 Ruby 1.9.3 和 rails313 gemset.</p>
<h4 id="使用-RVM-快速部署-Nginx-Passenger"><a href="#使用-RVM-快速部署-Nginx-Passenger" class="headerlink" title="使用 RVM 快速部署 Nginx + Passenger"></a>使用 RVM 快速部署 <code>Nginx</code> + <code>Passenger</code></h4><p><code>passenger是支持ruby的web服务器</code></p>
<p>首先安装 Passenger</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">gem install passenger</span><br></pre></td></tr></table></figure>
<p>然后使用 <code>passenger-install-nginx-module</code> 来安装 Nginx 和部署。</p>
<p><code></code></p>
<p>因为这一步需要 root 权限（因为要编译 Nginx）可以用 rvmsudo 这个东西（这个东西真是个好东西）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rvmsudo passenger-install-nginx-module</span><br></pre></td></tr></table></figure>
<p>然后会让你选择是下载 Nginx 源码自动编译安装，还是自己选择 Nginx 源码位置。</p>
<p><code></code></p>
<p>选择 Nginx 手动安装的可以添加别的编译参数，方便自定义编译 Nginx。</p>
<p><code></code></p>
<p>然后一路下载安装。默认的安装位置为 /opt/nginx.</p>
<p><code></code></p>
<p>然后看看 nginx.conf，都给你配置好了，只需要加上 root 位置（yourapp/public）就可以了。</p>
<h4 id="其他选择"><a href="#其他选择" class="headerlink" title="其他选择"></a>其他选择</h4><p>如果你不太喜欢RVM，可以选择<a href="https://github.com/rbenv/rbenv" target="_blank" rel="noopener">rbenv</a> 在rubychaina有一篇文章(rbenv实用指南)[<a href="https://ruby-china.org/wiki/rbenv-guide]" target="_blank" rel="noopener">https://ruby-china.org/wiki/rbenv-guide]</a></p>
<h3 id="三、bundler"><a href="#三、bundler" class="headerlink" title="三、bundler"></a>三、bundler</h3><p><strong>相当于多个<code>RubyGems</code>批处理运行。在配置文件<code>gemfilel</code>里说明你的应用依赖哪些第三方包，他自动帮你下载安装多个包，并且会下载这些包依赖的包</strong></p>
<p>如何使用？</p>
<p>你可以用 Bundler 的 <a href="http://bundler.io/v1.5/bundle_config.html#gem-source-mirrors" target="_blank" rel="noopener">Gem 源代码镜像命令</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ bundle config mirror.https://rubygems.org https://gems.ruby-china.org</span><br></pre></td></tr></table></figure>
<p>这样你不用改你的 Gemfile 的 source</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">source &apos;https://rubygems.org/&apos;</span><br><span class="line"></span><br><span class="line">gem &apos;rails&apos;, &apos;4.1.0&apos;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaodaxin.com/2017/01/21/2017-01-22-Useradd-sh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="3Golds">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gophers.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="3Golds">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/21/2017-01-22-Useradd-sh/" itemprop="url">添加一个用户sudo权限的使用密钥登录的用户</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-21T00:00:00+08:00">
                2017-01-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/01/21/2017-01-22-Useradd-sh/" class="leancloud_visitors" data-flag-title="添加一个用户sudo权限的使用密钥登录的用户">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  97
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1为用户名-2为用户公钥"><a href="#1为用户名-2为用户公钥" class="headerlink" title="$1为用户名 $2为用户公钥"></a><code>$1</code>为用户名 <code>$2</code>为用户公钥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#添加证书账户,并且将对应用户加入sudo</span><br><span class="line"># $1 为用户名 $2 为用户公钥</span><br><span class="line">[[ -z $3 ]] &amp;&amp; useradd $1 || useradd -d $3 $1</span><br><span class="line">mkdir /home/$1/.ssh</span><br><span class="line">echo &quot;$2&quot; &gt;/home/$1/.ssh/authorized_keys</span><br><span class="line">chown -R $1.$1 /home/$1/.ssh/</span><br><span class="line">chmod 600 /home/$1/.ssh/authorized_keys</span><br><span class="line">chmod 700 /home/$1/.ssh/</span><br><span class="line">sed -i &apos;/^root.*/a\&apos;$1&apos; ALL=(ALL) NOPASSWD:ALL&apos; /etc/sudoers</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaodaxin.com/2017/01/07/2017-01-07-git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="3Golds">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gophers.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="3Golds">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/07/2017-01-07-git/" itemprop="url">Git基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-07T00:00:00+08:00">
                2017-01-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/01/07/2017-01-07-git/" class="leancloud_visitors" data-flag-title="Git基础">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,538
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、git-install"><a href="#一、git-install" class="headerlink" title="一、git install"></a>一、git install</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Ubuntu</span><br><span class="line"></span><br><span class="line">sudo apt-get install git</span><br><span class="line"></span><br><span class="line">Centos</span><br><span class="line"></span><br><span class="line">yum install git  </span><br><span class="line"></span><br><span class="line">Mac</span><br><span class="line"></span><br><span class="line">brew install git</span><br></pre></td></tr></table></figure>
<h3 id="二、git-initialization-configure"><a href="#二、git-initialization-configure" class="headerlink" title="二、git initialization configure"></a>二、git initialization configure</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git config --global user.name &quot;Your Name&quot;</span><br><span class="line"></span><br><span class="line">git config --global user.email &quot;email@example.com&quot;</span><br></pre></td></tr></table></figure>
<h6 id="注意git-config命令的-global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址"><a href="#注意git-config命令的-global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址" class="headerlink" title="注意git config命令的--global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址"></a>注意<code>git config</code>命令的<code>--global</code>参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址</h6><h3 id="三、git-create-repository"><a href="#三、git-create-repository" class="headerlink" title="三、git create repository"></a>三、git create repository</h3><ul>
<li>git版本库，也叫仓库，英文为<code>repository</code>，可以理解为一个目录，目录里的文件都可以被git管理起来，每个文件的修改、删除Git都能跟踪，以便任何时候都能够追踪历史，或者将来在某个时刻可以还原。</li>
</ul>
<h5 id="1、创建一个目录"><a href="#1、创建一个目录" class="headerlink" title="1、创建一个目录"></a>1、创建一个目录</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ mkdir gitrepo</span><br><span class="line"></span><br><span class="line">$ cd gitrepo</span><br><span class="line"></span><br><span class="line">$ pwd</span><br><span class="line"></span><br><span class="line">/Users/antony/gitrepo</span><br></pre></td></tr></table></figure>
<p><code>注意：目录不要包含中文</code></p>
<h5 id="2、通过-git-init-命令把这个目录变成Git可以管理的仓库"><a href="#2、通过-git-init-命令把这个目录变成Git可以管理的仓库" class="headerlink" title="2、通过 git init 命令把这个目录变成Git可以管理的仓库"></a>2、通过 <code>git init</code> 命令把这个目录变成Git可以管理的仓库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line">Initialized empty Git repository in /Users/antony/gitrepo/.git/</span><br></pre></td></tr></table></figure>
<p>瞬间Git就把仓库建好了，而且告诉你是一个空的仓库（empty Git repository），细心的读者可以发现当前目录下多了一个<code>.git</code>的目录，这个目录是Git来跟踪管理版本库的，没事千万不要手动修改这个目录里面的文件，不然改乱了，就把Git仓库给破坏了。</p>
<h3 id="四、提交一个文件到仓库"><a href="#四、提交一个文件到仓库" class="headerlink" title="四、提交一个文件到仓库"></a>四、提交一个文件到仓库</h3><h5 id="1、创建一个文件"><a href="#1、创建一个文件" class="headerlink" title="1、创建一个文件"></a>1、创建一个文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ vim readme.txt</span><br><span class="line"></span><br><span class="line">This is a test file</span><br><span class="line"></span><br><span class="line">Git is a opensource app</span><br></pre></td></tr></table></figure>
<p>此文件一定要放在刚才创建的仓库下，即<code>gitrepo</code></p>
<h5 id="2、用命令git-add将文件添加到仓库"><a href="#2、用命令git-add将文件添加到仓库" class="headerlink" title="2、用命令git add将文件添加到仓库"></a>2、用命令<code>git add</code>将文件添加到仓库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git add readme.txt</span><br></pre></td></tr></table></figure>
<h5 id="3、用命令git-commit告诉Git，把文件提交到git仓库"><a href="#3、用命令git-commit告诉Git，把文件提交到git仓库" class="headerlink" title="3、用命令git commit告诉Git，把文件提交到git仓库"></a>3、用命令<code>git commit</code>告诉Git，把文件提交到git仓库</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git commit -m &quot;up a readme file&quot;</span><br><span class="line"></span><br><span class="line">[master (root-commit) ba4d5a3] up a readme file</span><br><span class="line"></span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br><span class="line"></span><br><span class="line"> create mode 100644 readme.txt</span><br></pre></td></tr></table></figure>
<p><code>-m</code> 添加描述，一般用来告诉此次提交的说明</p>
<p>为什么添加文件需要<code>add</code>,<code>commit</code>两步呢？ 因为<code>commit</code>一次可以提交多个文件，所以你可以多次<code>add</code>不同文件,比如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git add file1</span><br><span class="line"></span><br><span class="line">$ git add file2 file3</span><br><span class="line"></span><br><span class="line">$ git commit -m &quot;file2 file3&quot;</span><br></pre></td></tr></table></figure>
<h3 id="五、Git-Status、diff（状态、对比）"><a href="#五、Git-Status、diff（状态、对比）" class="headerlink" title="五、Git Status、diff（状态、对比）"></a>五、Git Status、diff（状态、对比）</h3><h5 id="1、Status"><a href="#1、Status" class="headerlink" title="1、Status"></a>1、Status</h5><p><code>修改文件</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ vim readme.txt #在最后一行新添加一行</span><br><span class="line"></span><br><span class="line">New line</span><br></pre></td></tr></table></figure>
<p><code>查看状态</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line"></span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line"></span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	modified:   readme.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>
<p><code>git status</code> 时刻查看文件的状态，通过返回信息告诉我们文件被修改了</p>
<h5 id="2、diff（查看具体修改内容）"><a href="#2、diff（查看具体修改内容）" class="headerlink" title="2、diff（查看具体修改内容）"></a>2、diff（查看具体修改内容）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git diff readme.txt</span><br><span class="line"></span><br><span class="line">diff --git a/readme.txt b/readme.txt</span><br><span class="line"></span><br><span class="line">index 194380c..e8e4b8b 100644</span><br><span class="line"></span><br><span class="line">--- a/readme.txt</span><br><span class="line"></span><br><span class="line">+++ b/readme.txt</span><br><span class="line"></span><br><span class="line">@@ -1,2 +1,3 @@</span><br><span class="line"></span><br><span class="line"> This is a test file</span><br><span class="line"></span><br><span class="line"> Git is a opensource app</span><br><span class="line"></span><br><span class="line">+New line</span><br><span class="line"></span><br><span class="line">(END)</span><br></pre></td></tr></table></figure>
<h5 id="3、查看add及commit后的状态"><a href="#3、查看add及commit后的状态" class="headerlink" title="3、查看add及commit后的状态"></a>3、查看add及commit后的状态</h5><p><code>git add后的状态</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git add readme.txt</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line"></span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	modified:   readme.txt</span><br></pre></td></tr></table></figure>
<p><code>git commit后的状态</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git commit -m &quot;add new line&quot;</span><br><span class="line"></span><br><span class="line">[master a782d05] add new line</span><br><span class="line"></span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>
<h3 id="六、版本回退"><a href="#六、版本回退" class="headerlink" title="六、版本回退"></a>六、版本回退</h3><p><strong>先修改一次文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ vim readme.txt</span><br><span class="line"></span><br><span class="line">New line 2</span><br></pre></td></tr></table></figure>
<p><strong>提交文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git add readme.txt</span><br><span class="line"></span><br><span class="line">$ git commit -m &quot;New line 2&quot;</span><br><span class="line"></span><br><span class="line">[master def33d7] New line 2</span><br><span class="line"></span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure>
<h5 id="1、版本提交历史记录git-log"><a href="#1、版本提交历史记录git-log" class="headerlink" title="1、版本提交历史记录git log"></a>1、版本提交历史记录<code>git log</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git log</span><br><span class="line"></span><br><span class="line">commit def33d73a1ded1b673f2b994bddedce9f8409a33</span><br><span class="line"></span><br><span class="line">Author: ZAntony &lt;zantony.top@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Date:   Sun Dec 11 22:36:53 2016 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    New line 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">commit a782d05f438ca21a2d2336e97256bf9d7e35c058</span><br><span class="line"></span><br><span class="line">Author: ZAntony &lt;zantony.top@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Date:   Sun Dec 11 22:19:43 2016 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    add new line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">commit ba4d5a316c0e915e768d0a793999ff9f5f41447b</span><br><span class="line"></span><br><span class="line">Author: ZAntony &lt;zantony.top@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Date:   Sun Dec 11 22:00:13 2016 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    up a readme file</span><br></pre></td></tr></table></figure>
<p>git 最近显示的是<code>New line 2</code>,上一次是<code>add new line</code>,第一次是<code>up a readme file</code></p>
<p><strong>可以通过<code>--pretty=oneline</code>参数控制输出内容的数量</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git log --pretty=oneline</span><br><span class="line"></span><br><span class="line">def33d73a1ded1b673f2b994bddedce9f8409a33 New line 2</span><br><span class="line"></span><br><span class="line">a782d05f438ca21a2d2336e97256bf9d7e35c058 add new line</span><br><span class="line"></span><br><span class="line">ba4d5a316c0e915e768d0a793999ff9f5f41447b up a readme file</span><br></pre></td></tr></table></figure>
<p><strong>前面的一串数字是16进制的commit id</strong></p>
<h5 id="2、git-reset-版本回退"><a href="#2、git-reset-版本回退" class="headerlink" title="2、git reset 版本回退"></a>2、git reset 版本回退</h5><p>首先，Git必须知道当前版本是哪个版本，在Git中，用HEAD表示当前版本，也就是最新的提交def33d……..9a33（注意我的提交ID和你的肯定不一样），上一个版本就是<code>HEAD^</code>，上上一个版本就是<code>HEAD^^</code>，当然往上100个版本写100个^比较容易数不过来，所以写成<code>HEAD~100</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git reset --hard HEAD^</span><br><span class="line"></span><br><span class="line">HEAD is now at a782d05 add new line</span><br><span class="line"></span><br><span class="line">This is a test file</span><br><span class="line"></span><br><span class="line">Git is a opensource app</span><br><span class="line"></span><br><span class="line">New line</span><br><span class="line"></span><br><span class="line"># 此时版本已经回退</span><br></pre></td></tr></table></figure>
<h5 id="3、当返回到上一个版本后，突然想返回到为返回前的版本，即New-line-2"><a href="#3、当返回到上一个版本后，突然想返回到为返回前的版本，即New-line-2" class="headerlink" title="3、当返回到上一个版本后，突然想返回到为返回前的版本，即New line 2"></a>3、当返回到上一个版本后，突然想返回到为返回前的版本，即<code>New line 2</code></h5><p>查看日志，发现并未找到回退前的版本的commit id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">commit a782d05f438ca21a2d2336e97256bf9d7e35c058</span><br><span class="line"></span><br><span class="line">Author: ZAntony &lt;zantony.top@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Date:   Sun Dec 11 22:19:43 2016 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    add new line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">commit ba4d5a316c0e915e768d0a793999ff9f5f41447b</span><br><span class="line"></span><br><span class="line">Author: ZAntony &lt;zantony.top@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">Date:   Sun Dec 11 22:00:13 2016 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    up a readme file</span><br></pre></td></tr></table></figure>
<h6 id="当通过git-reset-hard-HEAD-恢复到add-new-line时，在想恢复到之前的New-line-2-就必须找到他的commit-id，可以通过查看之前的命令历史来查找，也可以通过git-reflog来查看commit-id"><a href="#当通过git-reset-hard-HEAD-恢复到add-new-line时，在想恢复到之前的New-line-2-就必须找到他的commit-id，可以通过查看之前的命令历史来查找，也可以通过git-reflog来查看commit-id" class="headerlink" title="当通过git reset --hard HEAD^恢复到add new line时，在想恢复到之前的New line 2,就必须找到他的commit id，可以通过查看之前的命令历史来查找，也可以通过git reflog来查看commit id"></a>当通过<code>git reset --hard HEAD^</code>恢复到<code>add new line</code>时，在想恢复到之前的<code>New line 2</code>,就必须找到他的<code>commit id</code>，可以通过查看之前的命令历史来查找，也可以通过<code>git reflog</code>来查看commit id</h6><p><strong>git reflog</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git reflog # 通过命令来查看commit id，id是不完整的，但是可以使用，只要保证id唯一性。</span><br><span class="line"></span><br><span class="line">a782d05 HEAD@&#123;0&#125;: reset: moving to HEAD^</span><br><span class="line"></span><br><span class="line">def33d7 HEAD@&#123;1&#125;: commit: New line 2</span><br><span class="line"></span><br><span class="line">a782d05 HEAD@&#123;2&#125;: commit: add new line</span><br><span class="line"></span><br><span class="line">ba4d5a3 HEAD@&#123;3&#125;: commit (initial): up a readme file</span><br></pre></td></tr></table></figure>
<p><strong>恢复版本</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ git reset --hard def33d7</span><br><span class="line"></span><br><span class="line">HEAD is now at def33d7 New line 2</span><br><span class="line"></span><br><span class="line">$ cat readme.txt</span><br><span class="line"></span><br><span class="line">This is a test file</span><br><span class="line"></span><br><span class="line">Git is a opensource app</span><br><span class="line"></span><br><span class="line">New line</span><br><span class="line"></span><br><span class="line">New line 2</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/gophers.jpg"
                alt="3Golds" />
            
              <p class="site-author-name" itemprop="name">3Golds</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">36</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/3Golds" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:go80800@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">3Golds</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>








        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  
    

    
  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("bK3mQMcoKlwuLljKCOH5tsP1-gzGzoHsz", "343DJUSwdwM3miekBuwdNf24");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({});</script></body>
</html>
